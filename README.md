# YLab task 2

## Переменные среды
Для запуска и тестирования проекта, требуется файл `.env` с переменными окружения.
### Параметры
- `POSTGRES_HOST` - имя хоста
- `POSTGRES_PORT` - порт
- `POSTGRES_DB` - имя базы данных
- `POSTGRES_USER` - пользователь
- `POSTGRES_PASSWORD` - пароль

### Пример файла
```
POSTGRES_HOST=127.0.0.1
POSTGRES_PORT=5432
POSTGRES_DB=fastapiylab
POSTGRES_USER=fastapiylab
POSTGRES_PASSWORD=password123
```
`{POSTGRES_HOST}` используется только для локального запуска и в контейнере для запуска тестов, в docker-compose устанавливается значение `db`.

## Запуск через docker
```bat
docker-compose up -d
```
Перед выполнением создайте файл переменных окружения (`.env`). Пример файла см. [Переменные среды](#пример-файла).

## Запуск через ком строку
```bat
uvicorn app.main:app --reload
```
Перед запуском создайте файл переменных окружения (`.env`). Пример файла см. [Переменные среды](#пример-файла).

## Тестирование: docker
```bat
docker build -f Dockerfile.test -t fastapiylab-test:latest .
docker create --name fastapiylab-test --network=host --env-file=.env -t fastapiylab-test:latest
docker start -i fastapiylab-test
```
### Примечание
Перед началом тестирование создайте файл переменных окружения (`.env`).  
Пример файла см. [Переменные среды](#пример-файла).
### Особенности
Тестирование прод базы только на get запросы.  
CRUD тесты проводятся на тестовой базе.
### Тестовая база:
&emsp;**имя базы**: `{POSTGRES_DB}`_test;  
&emsp;**создание**: если отсутствует;  
&emsp;**удаление**: после тестирования база удаляется.  
Удаление производится вне зависимости от ее наличия на начало тестов.  

Postman работает с прод базой, поэтому основную базу не выносил на отдельный volume
(для postman тестов она должна быть чистой перед каждым запуском). 

## Тестирование: cmd
```bat
pytest -v
```
Пользователю СУБД требуются права создание базы данных.  
